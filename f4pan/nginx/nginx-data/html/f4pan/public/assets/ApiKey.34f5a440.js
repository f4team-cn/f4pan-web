import{M as F,d as A,r as b,ad as k,_ as E,e as x,g as s,h as p,i as l,o as _,L as w,f as B,j as C,k as K}from"./index.11a12647.js";import{s as R}from"./card.esm.d12aa2af.js";import{s as S,a as g}from"./column.esm.0cd960b8.js";import"./dropdown.esm.349dd9e4.js";import"./index.esm.ea66545a.js";import"./radiobutton.esm.2c6d9749.js";import"./index.esm.f152c46b.js";var T=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,r=[],n=0;n<t.rangeCount;n++)r.push(t.getRangeAt(n));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||r.forEach(function(d){t.addRange(d)}),e&&e.focus()}},L=T,h={"text/plain":"Text","text/html":"Url",default:"Text"},I="Copy to clipboard: #{key}, Enter";function N(t){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}function U(t,e){var r,n,d,o,c,a,f=!1;e||(e={}),r=e.debug||!1;try{d=L(),o=document.createRange(),c=document.getSelection(),a=document.createElement("span"),a.textContent=t,a.ariaHidden="true",a.style.all="unset",a.style.position="fixed",a.style.top=0,a.style.clip="rect(0, 0, 0, 0)",a.style.whiteSpace="pre",a.style.webkitUserSelect="text",a.style.MozUserSelect="text",a.style.msUserSelect="text",a.style.userSelect="text",a.addEventListener("copy",function(u){if(u.stopPropagation(),e.format)if(u.preventDefault(),typeof u.clipboardData>"u"){r&&console.warn("unable to use e.clipboardData"),r&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var i=h[e.format]||h.default;window.clipboardData.setData(i,t)}else u.clipboardData.clearData(),u.clipboardData.setData(e.format,t);e.onCopy&&(u.preventDefault(),e.onCopy(u.clipboardData))}),document.body.appendChild(a),o.selectNodeContents(a),c.addRange(o);var v=document.execCommand("copy");if(!v)throw new Error("copy command was unsuccessful");f=!0}catch(u){r&&console.error("unable to copy using execCommand: ",u),r&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),e.onCopy&&e.onCopy(window.clipboardData),f=!0}catch(i){r&&console.error("unable to copy using clipboardData: ",i),r&&console.error("falling back to prompt"),n=N("message"in e?e.message:I),window.prompt(n,t)}}finally{c&&(typeof c.removeRange=="function"?c.removeRange(o):c.removeAllRanges()),a&&document.body.removeChild(a),d()}return f}var D=U;function M(){return F({url:"/admin/api_keys/generate",withLogin:!0})}function $(){return F({url:"/admin/api_keys",withLogin:!0})}function j(t){return F({url:"/admin/api_keys/delete",method:"GET",params:{id:t},withLogin:!0})}const P={class:"col-12"},V={class:"md:flex md:flex-row md:flex-nowrap"},O=A({__name:"ApiKey",setup(t){const e=b(!1),r=b([]),n=K(),d=k(),o=b(!1),c=(u,i)=>{d.require({target:u.target,message:"\u60A8\u8981\u5220\u9664\u6B64\u5BC6\u94A5\u5417\uFF1F",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"\u53D6\u6D88",acceptLabel:"\u786E\u5B9A",accept:async()=>{try{n.default("\u6B63\u5728\u5220\u9664\u2026\u2026"),await j(i.id),n.success("\u5220\u9664\u6210\u529F");const m=r.value.findIndex(y=>y.id===i.id);r.value.splice(m,1)}catch{n.warn("\u5220\u9664\u5931\u8D25\uFF01")}}})},a=async()=>{o.value=!0;try{e.value=!0;const u=await $();u.data.data.length>0&&(r.value.length=0,r.value.push(...u.data.data))}catch{n.warn("\u52A0\u8F7D\u5BC6\u94A5\u5931\u8D25\uFF01\u8BF7\u7A0D\u540E\u5237\u65B0\u9875\u9762\uFF01")}finally{e.value=!1,o.value=!1}},f=u=>{D(u.key||""),n.success("\u590D\u5236\u6210\u529F\uFF01")},v=async()=>{o.value=!0;try{const{data:u}=(await M()).data;n.success("\u751F\u6210\u6210\u529F\uFF01\u5DF2\u81EA\u52A8\u590D\u5236\u3002"),D(u.key),await a()}catch{n.warn("\u751F\u6210\u5931\u8D25\uFF01")}finally{o.value=!1}};return E(a),(u,i)=>(_(),x("div",P,[s(l(R),null,{content:p(()=>[s(l(S),{value:r.value,dataKey:"id",tableStyle:"min-width: 60rem",loading:e.value},{loading:p(()=>[w(" \u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u2026\u2026 ")]),empty:p(()=>[w(" \u6682\u65F6\u6CA1\u6709\u6570\u636E\uFF0C\u6DFB\u52A0\u4E00\u4E2A\u5427\uFF01 ")]),header:p(()=>[B("div",V,[s(l(C),{loading:o.value,icon:"pi pi-plus",label:"\u6DFB\u52A0",class:"mr-2 mb-2 flex-grow-0",onClick:v},null,8,["loading"])])]),default:p(()=>[s(l(g),{field:"id",header:"ID",sortable:!0}),s(l(g),{field:"key",header:"KEY"}),s(l(g),{field:"use_count",header:"\u4F7F\u7528\u6B21\u6570"}),s(l(g),{header:"\u64CD\u4F5C"},{body:p(({data:m})=>[s(l(C),{icon:"pi pi-copy",rounded:"",class:"mb-2 mr-2",onClick:y=>f(m)},null,8,["onClick"]),s(l(C),{icon:"pi pi-trash",severity:"danger",rounded:"",class:"mb-2 mr-2",onClick:y=>c(y,m)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"])]),_:1})]))}});export{O as default};
